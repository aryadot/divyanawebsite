<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Article</title>
  <link rel="stylesheet" href="styles/article.css" />
</head>
<body>
  <nav class="bar">
    <a href="blog.html">← Back to Blog</a>
    <span id="meta"></span>
  </nav>

  <header class="hero">
    <h1 id="title">Loading…</h1>
    <p id="dek" class="dek"></p>
  </header>

  <main class="wrap">
    <article id="content" class="prose"></article>

    <nav class="post-nav">
      <a href="blog.html">← Back to Blog</a>
    </nav>
  </main>

  <!-- Markdown renderer -->
  <script type="module">
    import { marked } from 'https://cdn.jsdelivr.net/npm/marked/lib/marked.esm.js';

    const qs = new URLSearchParams(location.search);
    const post = qs.get('post');               // e.g., article1.md
    const title = qs.get('title') || '';
    const date = qs.get('date') || '';
    const read = qs.get('read') || '';

    // Set header text from query (optional)
    if (title) document.getElementById('title').textContent = decodeURIComponent(title);
    const meta = [date, read && `${read} min read`].filter(Boolean).join(' • ');
    if (meta) document.getElementById('meta').textContent = meta;

    if (!post) {
      document.getElementById('content').innerHTML = '<p>Missing <code>?post=</code> parameter.</p>';
    } else {
      try {
        const res = await fetch(`posts/${post}`);
        const md = await res.text();
        // Optional: first paragraph becomes dek if you want
        document.getElementById('content').innerHTML = marked.parse(md);
        // If you want an excerpt line under the H1, grab first <p>:
        const firstP = document.querySelector('.prose > p');
        if (firstP && !document.getElementById('dek').textContent) {
          document.getElementById('dek').textContent = firstP.textContent.slice(0, 200);
        }
      } catch (e) {
        document.getElementById('content').innerHTML = '<p>Could not load the article.</p>';
      }
    }
  </script>
</body>
</html>
